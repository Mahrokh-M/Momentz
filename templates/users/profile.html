{% extends 'base.html' %}
{% load static %}

{% block title %}{{ profile.username }}'s Profile - Momentz{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Profile Card -->
    <div class="cyber-card p-6 mb-8 border border-neon-cyan shadow-lg transition-all duration-300 hover:shadow-neon">
        <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
            <div class="flex-shrink-0">
                <img src="{{ profile.picture_url|default:'/static/images/default_avatar.jpg' }}" 
                     class="rounded-full border-4 border-neon-purple w-32 h-32 object-cover shadow-md">
            </div>
            <div class="flex-grow text-center md:text-left">
                <h2 class="text-3xl font-bold text-neon-cyan glitch-effect" data-text="{{ profile.username }}">
                    {{ profile.username }}
                </h2>
                {% if profile.full_name %}<p class="text-neon-purple text-lg mt-1">{{ profile.full_name }}</p>{% endif %}
                {% if profile.bio %}<p class="text-gray-300 mt-3 italic">{{ profile.bio }}</p>{% endif %}

                <!-- Stats -->
                <div class="flex justify-center md:justify-start space-x-8 mt-6 text-neon-pink">
                    <div class="text-center">
                        <span class="block text-2xl font-bold">{{ profile.post_count }}</span>
                        <span class="text-sm">POSTS</span>
                    </div>
                    <div class="text-center">
                        <span class="block text-2xl font-bold">{{ profile.followers_count }}</span>
                        <span class="text-sm">FOLLOWERS</span>
                    </div>
                    <div class="text-center">
                        <span class="block text-2xl font-bold">{{ profile.following_count }}</span>
                        <span class="text-sm">FOLLOWING</span>
                    </div>
                </div>

                {% if request.user.username != profile.username %}
                <!-- Follow Button -->
                <form action="{% url 'users:follow_user' profile.user_id %}" method="post" class="mt-6">
                    {% csrf_token %}
                    <input type="hidden" name="username" value="{{ profile.username }}">
                    <button type="submit" class="cyber-btn bg-neon-cyan text-black hover:bg-neon-purple hover:text-white shadow-md">
                        {% if is_following %}
                            <i class="fas fa-user-minus"></i> UNFOLLOW
                        {% else %}
                            <i class="fas fa-user-plus"></i> FOLLOW
                        {% endif %}
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Posts Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for post in posts %}
        <div class="cyber-card border border-neon-cyan hover:border-neon-purple bg-gray-950 shadow-md hover:shadow-lg transition duration-300">
            {% if post.image_url %}
            <div class="relative overflow-hidden rounded-t" style="padding-top: 100%;">
                <img src="{{ post.image_url }}" 
                     class="absolute top-0 left-0 w-full h-full object-cover transform hover:scale-105 transition-transform duration-500"
                     alt="Post image">
            </div>
            {% endif %}
            <div class="p-4 flex flex-col justify-between h-full">
                <p class="text-neon-cyan text-sm">{{ post.content|truncatechars:100 }}</p>
                <div class="flex justify-between items-center mt-4">
                    <div class="flex space-x-3 text-neon-pink text-xs">
                        <span>{{ post.like_count }} â™¥</span>
                        <span>{{ post.comment_count }} ðŸ’¬</span>
                    </div>
                    <div class="flex space-x-2">
                        <form action="{% url 'posts:like' post.post_id %}" method="post" class="like-form" data-post-id="{{ post.post_id }}">
                            {% csrf_token %}
                            <button type="submit" class="cyber-btn-sm {% if post.is_liked %}bg-neon-pink{% endif %}" id="like-btn-{{ post.post_id }}">
                                {% if post.is_liked %}â™¥{% else %}â™¡{% endif %}
                            </button>
                        </form>
                        <a href="{% url 'posts:post_detail' post.post_id %}" class="cyber-btn-sm bg-neon-cyan text-black hover:bg-neon-purple hover:text-white">
                            VIEW
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-span-3 text-center py-10">
            <p class="text-neon-cyan text-xl">NO POSTS YET</p>
            <p class="text-gray-400 mt-2">When {{ profile.username }} posts, you'll see it here</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Styles -->
<style>
.glitch-effect {
    position: relative;
    display: inline-block;
}

.glitch-effect::before,
.glitch-effect::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0.6;
    color: #ff00ff;
    pointer-events: none;
    z-index: -1;
}

.glitch-effect::before {
    transform: translate(1px, -1px);
}

.glitch-effect::after {
    transform: translate(-1px, 1px);
}

.glitch-effect:hover::before,
.glitch-effect:hover::after {
    animation: glitch 0.2s infinite;
}

@keyframes glitch {
    0% { transform: translate(1px, -1px); }
    20% { transform: translate(-2px, 2px); }
    40% { transform: translate(2px, 2px); }
    60% { transform: translate(-1px, -2px); }
    80% { transform: translate(1px, 2px); }
    100% { transform: translate(0, 0); }
}

.cyber-card {
    background-color: #0f0f1a;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.cyber-btn-sm {
    padding: 0.3rem 0.75rem;
    font-size: 0.75rem;
    border-radius: 0.3rem;
    font-weight: bold;
    transition: all 0.3s ease;
}

.cyber-btn {
    padding: 0.5rem 1rem;
    font-weight: bold;
    border-radius: 0.375rem;
    transition: all 0.3s ease;
}

.cyber-btn:hover, .cyber-btn-sm:hover {
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
}

.shadow-neon {
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
}
</style>
{% endblock %}
